<!DOCTYPE html>
<html>
<head>
  <title>Soccer Match Odds</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #f8f9fa;
    padding: 20px;
    max-width: 800px;
    margin: auto;
  }

  h1 {
    text-align: center;
  }

  .match {
    background: #ffffff;
    border: 1px solid #ddd;
    border-left: 5px solid #007bff;
    margin: 15px 0;
    padding: 15px;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  }

  .match h3 {
    margin: 0;
    font-size: 20px;
  }

  .match small {
    color: #666;
  }

  .match button {
    margin-top: 10px;
    padding: 6px 12px;
    font-size: 14px;
    border: none;
    background-color: #007bff;
    color: white;
    border-radius: 4px;
    cursor: pointer;
  }

  .match button:hover {
    background-color: #0056b3;
  }

  .odds-list {
    list-style: none;
    padding-left: 0;
  }

  .odds-list li {
    margin-bottom: 4px;
  }

  .odds-list li span {
    font-weight: bold;
  }

  .form-badge {
    display: inline-block;
    margin-right: 5px;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    color: white;
  }

  .form-W { background-color: #28a745; }
  .form-D { background-color: #6c757d; }
  .form-L { background-color: #dc3545; }
</style>

</head>
<body>
  <h1>Today's Matches</h1>

  <input
  type="text"
  id="searchInput"
  placeholder="Search by team..."
  oninput="filterMatches()"
  style="width: 100%; padding: 10px; margin-bottom: 20px; font-size: 16px;"
/>

<div id="matches"></div>

<script>
  let allMatches = [];

  fetch('/api/matches')
    .then(res => res.json())
    .then(data => {
      if (!Array.isArray(data)) {
        document.getElementById('matches').innerHTML = '<p>⚠️ Error loading match data.</p>';
        console.error('Unexpected API response:', data);
        return;
      }

      allMatches = data;
      renderMatches(data);
    })
    .catch(err => {
      document.getElementById('matches').innerText = 'Error loading matches.';
      console.error(err);
    });

  // Optional: return sample data if API fails

  function filterMatches() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const filtered = allMatches.filter(match =>
      match.home.toLowerCase().includes(input) ||
      match.away.toLowerCase().includes(input)
    );
    renderMatches(filtered);
  }

  function renderMatches(data) {
    const container = document.getElementById('matches');
    container.innerHTML = '';

    if (data.length === 0) {
      container.innerHTML = '<p>No matches found.</p>';
      return;
    }

    data.forEach((match, index) => {
      const div = document.createElement('div');
      div.className = 'match';

      const odds = match.odds || {};
      const homeForm = match.form?.[match.home] || ['W', 'W', 'L', 'D', 'W'];
      const awayForm = match.form?.[match.away] || ['D', 'L', 'W', 'L', 'D'];

      div.innerHTML = `
        <h3>${match.home} vs ${match.away}</h3>
        <small>League: ${match.league}</small><br>
        <small>Time: ${new Date(match.time).toLocaleString()}</small><br><br>

        <button onclick="toggleDetails(${index})">Details ⬇️</button>
        <div id="details-${index}" style="display: none; margin-top: 10px;">
          <b>Odds:</b>
          <ul class="odds-list">
            <li><span>${match.home}</span>: ${odds["Home"] || "N/A"}</li>
            <li><span>Draw</span>: ${odds["Draw"] || "N/A"}</li>
            <li><span>${match.away}</span>: ${odds["Away"] || "N/A"}</li>
          </ul>

          <b>Form:</b><br>
          <span>${match.home}:</span>
          ${homeForm.map(r => `<span class="form-badge form-${r}">${r}</span>`).join('')}
          <br>
          <span>${match.away}:</span>
          ${awayForm.map(r => `<span class="form-badge form-${r}">${r}</span>`).join('')}
        </div>
      `;

      container.appendChild(div);
    });
  }

  function toggleDetails(index) {
    const detailDiv = document.getElementById(`details-${index}`);
    detailDiv.style.display = detailDiv.style.display === 'none' ? 'block' : 'none';
  }
</script>


</body>
</html>
